---
title: "pm2 알아보기"
date: 2025-08-26T00:00:00
toc: true
toc_sticky: true
categories:
    - DevOps
tags:
    - Node.js
---

# pm2

- `pm2`는 Node.js 애플리케이션을 **프로덕션 환경에서 안정적으로 실행**하기 위해 자주 쓰이는 **프로세스 관리자**

### pm2가 하는 일

- 앱 자동 재시작 (에러나 서버 재부팅 시)
- 여러 인스턴스 클러스터링 (CPU 코어 활용)
- 로그 관리 (stdout, stderr)
- 메모리 제한 초과 시 자동 재시작
- 환경변수 관리 (.env처럼)

### 설치

```bash
npm install -g pm2
```

### 기본 명령어

| 기능 | 명령어 예시 |
| --- | --- |
| 앱 실행 | `pm2 start app.js` |
| 앱 이름 설정 | `pm2 start app.js --name my-app` |
| 앱 목록 보기 | `pm2 list` |
| 앱 로그 보기 | `pm2 logs` |
| 앱 재시작 | `pm2 restart my-app` |
| 앱 종료 | `pm2 stop my-app` |
| 앱 삭제 | `pm2 delete my-app` |
| 부팅 시 자동 실행 설정 | `pm2 startup` → `pm2 save` |

### 예시

```bash
pm2 start dist/main.js --name my-api
```

- Nest.js나 TypeScript 프로젝트에서 빌드된 파일을 실행할 때 이렇게 사용함

### 요약

- `pm2`는 Node.js 앱을 **백그라운드 실행 + 오류 복구 + 서버 재시작 후 자동 실행**할 수 있게 도와주는 도구
- **운영 환경 배포 필수 툴 중 하나**

---

# Docker vs pm2

- Docker 컨테이너 안에서는 pm2는 꼭 필요하지 않다
- 하지만 때에 따라 쓸 수도 있음

## 비교 요약

| 항목 | Docker에서 직접 실행 (`node app.js`) | Docker + pm2 (`pm2 start app.js`) |
| --- | --- | --- |
| 프로세스 관리 | Docker가 담당 | pm2가 내부적으로 관리 |
| 앱 자동 재시작 | Docker가 컨테이너 단위로 관리 | pm2가 앱 프로세스 단위로 관리 |
| 로드밸런싱 (클러스터링) | 없음 | pm2의 클러스터 모드 가능 |
| 로그 관리 | `docker logs` 사용 | `pm2 logs`, 파일로 저장 가능 |
| 복수 앱 실행 | Dockerfile 안에서 어렵거나 권장되지 않음 | pm2로 여러 앱 실행 가능 |

## 상황에 따른 선택

### 1. 단일 앱 컨테이너 (일반적)

- 그냥 `CMD ["node", "app.js"]` 사용
- **pm2 필요 없음**
- Docker 자체가 재시작, 로그 등 관리하니까

### 2. 컨테이너 내부에서 **여러 Node 앱** 실행하고 싶을 때

- 이건 **안티 패턴이지만**, pm2로 관리 가능
- 예: `pm2 start app1.js && pm2 start app2.js`

### 3. **Node.js 클러스터링**을 컨테이너 내부에서 하고 싶을 때

- `pm2 start app.js -i max` 로 여러 코어 활용
- 단, 이건 Docker에서 **컨테이너 단위 스케일링**으로 대체 가능

## 결론

- **Docker 안에선 pm2는 거의 필요 없다**
- Docker가 프로세스를 1개만 관리하는 구조라서 `node app.js`로 충분
- 클러스터링이나 복수 앱 실행, 상세 로그 분리 같은 특별한 경우에만 pm2 고려

---

# Docker+pm2 vs Docker or pm2

- pm2의 역할이 Docker의 역할과 겹치기 때문에 굳이 Docker 컨테이너 안에서 pm2(Docker+pm2)로 관리할 필요는 없다

## 요점 정리

| 조합 | 추천 여부 | 설명 |
| --- | --- | --- |
| **Docker만** | 추천 | 단일 앱 컨테이너, 배포 간편, 확장 쉬움 |
| **pm2만 (서버 직접 실행)** | 추천 | VM/물리서버 환경에서 간단하게 운영 가능 |
| **Docker + pm2** | 비추천 (대부분) | 겹치는 기능 많고 불필요하게 복잡함 |

## 왜 Docker + pm2가 불필요한가

- Docker는 **컨테이너 자체가 1개의 프로세스를 관리**하는 구조야
- pm2의 역할(재시작, 로그, 클러스터링)을 **Docker 자체 혹은 K8s가 대신함**
- 결과적으로 **중복된 역할 + 관리 복잡성 증가**

## 실전에서 선택 기준

| 상황 | 추천 방식 |
| --- | --- |
| 클라우드 인프라(Docker, K8s 기반) | Docker 단독 |
| 단일 서버 (EC2, 물리서버, VM) | pm2 단독 |
| 여러 Node.js 인스턴스 실행 필요 | pm2 클러스터 모드 or Docker 다중 컨테이너 |
| CI/CD 구축, 이식성 중요 | Docker (pm2 불필요) |

## 결론

- Docker 쓰면 pm2 안 써도 됨
- **pm2 쓸 거면 굳이 Docker로 감쌀 필요 없음**

---

# Docker 거르고 pm2를 쓸 이유?

- Docker로 표준화 되어있고 환경 이식도 편한데, 굳이 pm2를 써야하는 pm2만의 차별성이나 경쟁성이 뭐가 있을까?

## 핵심 요약

- pm2의 경쟁력은 "Docker 안 쓰는 전통적 환경"에서 빛남.
- Docker 환경에선 **pm2만의 차별점은 거의 사라진다.**

## 그럼에도 불구하고 pm2가 유효한 경우

| 시나리오 | pm2의 강점 |
| --- | --- |
| **단일 서버 운영 (EC2, 온프레미스)** | OS 프로세스 관리 없이 Node 앱 여러 개 실행 가능 |
| **빠른 배포 (Dev/QA 서버)** | `pm2 deploy`, `ecosystem.config.js`로 손쉽게 배포 자동화 |
| **간단한 부하 분산** | `pm2 -i max`로 클러스터링, CPU 코어 최대 활용 |
| **서버 접근 쉬운 환경** | 실시간 로그 확인, 리로딩, 모니터링 기능 (`pm2 monit`) |

## Docker 대비 pm2만의 장점이 약한 이유

| 항목 | Docker가 이미 제공하는 기능 |
| --- | --- |
| 재시작 | `--restart=always`, K8s에서 pod 자동 복구 |
| 로그 관리 | `docker logs`, ELK, Loki 같은 로그 시스템 연동 |
| 클러스터링 | 컨테이너 여러 개로 scale-out (K8s 등으로 부하 분산) |
| 환경변수 | `.env`, `docker-compose.yml`, `Secrets` |
| 배포 자동화 | CI/CD 파이프라인 (GitHub Actions, GitLab CI 등) |

## 실무 현실 요약

- 대규모 시스템 or 클라우드 인프라 기반:
    - **Docker + K8s가 거의 표준**, pm2는 필요 없음
- 중소규모/레거시 시스템:
    - **pm2가 더 간단하고 빠름**, 특히 배포 자동화나 로그 보기에 유리

## 결론

| 조건 | 추천 |
| --- | --- |
| 표준화, 이식성, 확장성 중요 | Docker (pm2 불필요) |
| 소규모 서버, 빠른 운영이 핵심 | pm2 단독 |
| 둘 다 쓰기? | **거의 안 함**, 유지관리 복잡도만 증가 |