---
title: "트랜잭션 격리와 전파"
date: 2025-12-02T00:00:00
toc: true
toc_sticky: true
categories:
    - DB
tags:
    - Transaction
---

# 트랜잭션 격리와 전파

# 트랜잭션에서 발생할 수 있는 동시성 문제들

## **Dirty Read**:

- 한 트랜잭션이 다른 트랜잭션에서 아직 커밋되지 않은 데이터를 읽는 것.

## **Non-repeatable Read**:

- 한 트랜잭션에서 동일한 데이터를 여러 번 읽을 때, 다른 트랜잭션이 그 데이터를 수정하거나 삭제하여 읽은 값이 달라지는 것.

## **Phantom Read**:

- 한 트랜잭션이 데이터의 범위를 여러 번 조회할 때, 다른 트랜잭션이 데이터를 추가하거나 삭제하여 조회 결과가 달라지는 것.

---

# 격리 (Isolation level):

- DB 내용
- 격리 수준은 동시에 실행되는 트랜잭션 간의 간섭을 제어하여 데이터의 일관성을 유지하는 데 중점

## READ UNCOMMITTED

- 가장 낮은 격리 수준으로, 트랜잭션이 커밋되지 않은 데이터를 다른 트랜잭션이 읽을 수 있다. 이로 인해 **Dirty Read**가 발생할 수 있다.
- 성능이 매우 좋지만 데이터 일관성이 보장되지 않는다.
- **허용되는 문제**:
    - Dirty Read, Non-repeatable Read, Phantom Read.

## READ COMMITTED (기본값)

- 대부분의 데이터베이스에서 기본적으로 사용하는 격리 수준으로, 트랜잭션이 커밋된 데이터만 읽을 수 있다. **Dirty Read**를 방지하지만, **Non-repeatable Read**와 **Phantom Read**는 발생할 수 있다.
- 적절한 성능과 데이터 일관성의 균형을 제공한다.
- **허용되는 문제**:
    - Non-repeatable Read, Phantom Read.

## REPEATABLE READ

- 한 트랜잭션 내에서 동일한 데이터를 여러 번 읽을 때, 다른 트랜잭션이 그 데이터를 수정하거나 삭제할 수 없게 한다. **Non-repeatable Read**를 방지하지만, **Phantom Read**는 여전히 발생할 수 있다.
- 데이터 일관성을 보다 강화하지만 성능은 다소 저하될 수 있다.
- **허용되는 문제**:
    - Phantom Read.

## SERIALIZABLE

- 가장 높은 격리 수준으로, 트랜잭션들이 순차적으로 실행되도록 하여 모든 트랜잭션을 직렬화하여 처리한다. **Phantom Read**를 방지하며, 데이터베이스 일관성을 최대한 보장한다.
- 데이터 일관성을 가장 잘 보장하지만 성능 저하가 가장 크다.
- **허용되는 문제**:
    - 없음 (모든 동시성 문제를 방지).

---

# 전파 (Propagation)

- 스프링 내용
- 트랜잭션이 다른 트랜잭션과 함께 실행될 때, 트랜잭션 간의 관계와 실행 방식을 제어

## REQUIRED (기본값):

- 현재 트랜잭션이 존재하면 그 트랜잭션에 참여하고, 없으면 새로운 트랜잭션을 시작한다.
- 가장 일반적인 전파 방식으로, 대부분의 경우에 사용된다.

## REQUIRES_NEW:

- 항상 새로운 트랜잭션을 시작하며, 이미 존재하는 트랜잭션이 있으면 일시 중단시킨다.
- 기존 트랜잭션과 별도의 트랜잭션을 독립적으로 실행하고자 할 때 사용한다.

## MANDATORY:

- 반드시 기존 트랜잭션 내에서 실행되어야 하며, 기존 트랜잭션이 없으면 예외를 발생시킨다.
- 트랜잭션이 반드시 존재해야 하는 상황에서 사용된다.

## SUPPORTS:

- 트랜잭션이 존재하면 그 트랜잭션에 참여하고, 없으면 트랜잭션 없이 실행된다.
- 트랜잭션이 필수적이지 않은 작업에서 사용된다.

## NOT_SUPPORTED:

- 트랜잭션 없이 실행되며, 현재 트랜잭션이 존재하면 일시 중단시킨다.
- 트랜잭션이 필요 없는 작업이나, 트랜잭션을 회피해야 하는 경우에 사용된다.

## NEVER:

- 트랜잭션 없이 실행되며, 현재 트랜잭션이 존재하면 예외를 발생시킨다.
- 트랜잭션이 반드시 없어야 하는 상황에서 사용된다.

## NESTED

- 현재 트랜잭션 내에서 중첩된 트랜잭션을 시작하며, 부모 트랜잭션에 영향을 받는다. 부모 트랜잭션이 롤백되면 중첩된 트랜잭션도 롤백된다.
- 복잡한 트랜잭션 처리 로직에서 부모-자식 관계의 트랜잭션을 처리할 때 유용하다.